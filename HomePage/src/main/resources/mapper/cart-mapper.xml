<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.demo.dao.cart.CartDao">
	<select id="sumByUsername" resultType="Long">
		select sum(b.book_price*c.cart_count) as 총합 from cart c
		inner join book b on c.bno=b.bno
		inner join member m on c.member_id=m.member_id 
		where m.member_id=#{memnerId} and 
		;
	</select>


	<update id="increase">
    <![CDATA[
        UPDATE cart
        SET cart_count = cart_count + 1
        WHERE cno = #{cno}
        AND member_id = #{memberId}
        ]]>
    </update>

		<update id="decrease">
        <![CDATA[
        UPDATE cart
        SET cart_count = cart_count - 1 
        WHERE cno = #{cno}
        AND member_id = #{memberId}
        AND cart_count > 0 -- 수량이 0 이하로 내려가지 않도록 확인
        ]]>
    	</update>
    
      <select id="findByUsername" parameterType="string" resultType="cart">
        SELECT 
        cart.cno,book.bno,member.member_id,cart_count,book.book_title,book.subtitle,book.publish_date,book.book_price,
		book.stock,member.member_point,book_image.image_name
        FROM cart 
        INNER JOIN book ON cart.bno = book.bno
        INNER JOIN member ON cart.member_id = member.member_id
        INNER JOIN book_image ON cart.bno = book_image.bno
        WHERE member.member_id = #{memberId}
        
    </select>
    
     <select id="findById" parameterType="long" resultType="cart">
        SELECT *
        FROM cart 
        INNER JOIN book ON cart.bno = book.bno
        INNER JOIN member ON cart.member_id = member.member_id
        INNER JOIN book_image ON cart.bno = book_image.bno
        WHERE cart.cno = #{cno}
    </select>
    
    
    

</mapper>



